# head(ukb_data_list$`Fluid intelligence / reasoning`)
load_ukbdata("Body size measures")
get_field_data(ids = c("20179","20242","3160"))
load_ukbdata("Body size measures","Fluid intelligence / reasoning")
load_ukbdata(c("Body size measures","Fluid intelligence / reasoning"))
get_field_data(ids = c("20179","20242","3160"))
a = get_field_data(ids = c("20179","20242","3160"))
do.call(rbind,a)
do.call(cbind,a)
devtools::install_github('tbilab/UKBBdata')
devtools::install_github('tbilab/UKBBdata')
devtools::install_github('tbilab/UKBBdata')
UKBBdata::load_ukbdata("Asthma Outcomes")
library(aws.s3)
library(dplyr)
library(stringr)
UKBBdata::load_ukbdata("Asthma Outcomes")
UKBBdata::load_ukbdata("Asthma outcomes")
View(ukb_data_list)
ukb_data_list$`Asthma outcomes`
cat_list = aws.s3::s3readRDS("s3://ukb.tbilab/genome/UKB_Category_ID.rds")
cat_list
ids = c("123")
is.numeric(ids[1])
is.character(ids[1])
!is.na(as.numeric(ids))
is.na(as.numeric(ids))
keyorid = c("123","abc")
is.na(as.numeric(keyorid))
keyorid[is.na(as.numeric(keyorid))]
keyorid[!is.na(as.numeric(keyorid))]
id_loc = which(!is.na(as.numeric(keyorid)))
id_loc
keyorid[id_loc]
cat_list
cat_list %>% filter(CategoryID %in% id)
library(dplyr)
cat_list %>% filter(CategoryID %in% id)
id
id_loc = which(!is.na(as.numeric(keyorid)))
id = keyorid[id_loc]
id
cat_list %>% filter(CategoryID %in% id)
keyorid[id_loc] = cat_list %>% filter(CategoryID %in% id) %>% select(Category)
keyorid
keyorid = c("123","abc")
id_loc = which(!is.na(as.numeric(keyorid)))
id = keyorid[id_loc]
id
id_loc
keyorid[id_loc] = unlist(cat_list %>% filter(CategoryID %in% id) %>% select(Category))
keyorid
prepare_get_category = function(keyorid = NULL){
cat_list = aws.s3::s3readRDS("s3://ukb.tbilab/genome/UKB_Category_ID.rds")
if (!is.null(keyorid)){
id_loc = which(!is.na(as.numeric(keyorid)))
id = keyorid[id_loc]
keyorid[id_loc] = unlist(cat_list %>% filter(CategoryID %in% id) %>% select(Category))
cat_list = cat_list[str_detect(cat_list$Category,paste(keyorid,collapse = '|')),]
}
return(cat_list)
}
prepare_get_category(c("Asthma","blood"))
library(stringr)
prepare_get_category(c("Asthma","blood"))
prepare_get_category = function(keyorid = NULL){
cat_list = aws.s3::s3readRDS("s3://ukb.tbilab/genome/UKB_Category_ID.rds")
if (!is.null(keyorid)){
id_loc = suppressWarnings(which(!is.na(as.numeric(keyorid))))
id = keyorid[id_loc]
keyorid[id_loc] = unlist(cat_list %>% filter(CategoryID %in% id) %>% select(Category))
cat_list = cat_list[str_detect(cat_list$Category,paste(keyorid,collapse = '|')),]
}
return(cat_list)
}
prepare_get_category(c("Asthma","blood"))
prepare_get_category(c("Asthma","blood","46"))
load_ukbdata <- function(cats = c("ALL")){
ukb_dic = aws.s3::s3readRDS("s3://ukb.tbilab/genome/UKB_Field_Dictionary.rds")
ukb_dic <<- ukb_dic
ukb_data_list = list()
if (cats[1] == "ALL"){
ukb_data_list[["ALL"]] = aws.s3::s3readRDS("s3://ukb.tbilab/genome/ukb49913.rds")
}
else{
for (cat in cats){
if (!is.na(as.numeric(cat))){
cat = unlist(cat_list %>% filter(CategoryID == cat) %>% select(Category))
}
orig_cat = cat
cat = str_replace_all(cat,"/"," or ")
ukb_data_list[[orig_cat]] = aws.s3::s3readRDS(paste0("s3://ukb.tbilab/genome/Categorized/",cat,".rds"))
}
}
ukb_data_list <<- ukb_data_list
print("Completed!")
}
load_ukbdata(c("Asthma outcomes","Fluid intelligence / reasoning","46"))
names(ukb_data_list)
load_ukbdata <- function(cats = c("ALL")){
ukb_dic = aws.s3::s3readRDS("s3://ukb.tbilab/genome/UKB_Field_Dictionary.rds")
ukb_dic <<- ukb_dic
ukb_data_list = list()
if (cats[1] == "ALL"){
ukb_data_list[["ALL"]] = aws.s3::s3readRDS("s3://ukb.tbilab/genome/ukb49913.rds")
}
else{
for (cat in cats){
if (suppressWarnings(!is.na(as.numeric(cat)))){
cat = unlist(cat_list %>% filter(CategoryID == cat) %>% select(Category))
}
orig_cat = cat
cat = str_replace_all(cat,"/"," or ")
ukb_data_list[[orig_cat]] = aws.s3::s3readRDS(paste0("s3://ukb.tbilab/genome/Categorized/",cat,".rds"))
}
}
ukb_data_list <<- ukb_data_list
print("Completed!")
}
load_ukbdata(c("Asthma outcomes","Fluid intelligence / reasoning","46"))
ukb_data_list
View(ukb_dic)
View(ukb_dic)
get_field_data(c("Sex","20179","20242","3160"))
get_field_data = function(keyorid = NULL,match_name=FALSE){
if (!is.null(keyorid)){
id_loc = suppressWarnings(which(is.na(as.numeric(keyorid))))
keyorid[id_loc] = ukb_dic[str_detect(ukb_dic$Field,paste(keyorid[id_loc],collapse = "|")),FieldID]
}
cats = unlist(ukb_dic %>% filter(FieldID %in% ids) %>% distinct(Category))
loaded_cats = names(ukb_data_list)
patterns = paste0("^",ids,"-")
output = list()
if (loaded_cats[1] == "ALL"){
output = ukb_data_list[["ALL"]][str_detect(colnames(ukb_data_list[["ALL"]]),paste(patterns,collapse = "|"))]
}
else{
for (cat in cats){
if (cat %in% loaded_cats){
found = ukb_data_list[[cat]][str_detect(colnames(ukb_data_list[[cat]]),paste(patterns,collapse = "|"))]
if (ncol(found)>0){
output[[cat]] = cbind(data.frame(eid = ukb_data_list[[cat]][,1]),found)
}
}
else{
print(paste0("You need to load the category: ",cat))
}
}
}
return (output)
}
get_field_data(c("Sex","20179","20242","3160"))
get_field_data = function(keyorid = NULL,match_name=FALSE){
if (!is.null(keyorid)){
id_loc = suppressWarnings(which(is.na(as.numeric(keyorid))))
keyorid[id_loc] = ukb_dic[str_detect(ukb_dic$Field,paste(keyorid[id_loc],collapse = "|")),"FieldID"]
}
cats = unlist(ukb_dic %>% filter(FieldID %in% ids) %>% distinct(Category))
loaded_cats = names(ukb_data_list)
patterns = paste0("^",ids,"-")
output = list()
if (loaded_cats[1] == "ALL"){
output = ukb_data_list[["ALL"]][str_detect(colnames(ukb_data_list[["ALL"]]),paste(patterns,collapse = "|"))]
}
else{
for (cat in cats){
if (cat %in% loaded_cats){
found = ukb_data_list[[cat]][str_detect(colnames(ukb_data_list[[cat]]),paste(patterns,collapse = "|"))]
if (ncol(found)>0){
output[[cat]] = cbind(data.frame(eid = ukb_data_list[[cat]][,1]),found)
}
}
else{
print(paste0("You need to load the category: ",cat))
}
}
}
return (output)
}
get_field_data(c("Sex","20179","20242","3160"))
keyorid = c("Sex","20179","20242","3160")
id_loc = suppressWarnings(which(is.na(as.numeric(keyorid))))
id_loc
which(is.na(as.numeric(keyorid)))
as.numeric(keyorid)
which(is.na(as.numeric(keyorid)))
keyorid[id_loc]
paste(keyorid[id_loc],collapse = "|")
str_detect(ukb_dic$Field,paste(keyorid[id_loc],collapse = "|"))
sum(str_detect(ukb_dic$Field,paste(keyorid[id_loc],collapse = "|")))
ukb_dic[str_detect(ukb_dic$Field,paste(keyorid[id_loc],collapse = "|")),"FieldID"]
ukb_dic[str_detect(ukb_dic$Field,paste(keyorid[id_loc],collapse = "|")),]
get_field_data(c("20179","20242","3160"))
get_field_data(c("Sexually molested as a child","20179","20242","3160"))
get_field_data = function(keyorid = NULL,match_name=FALSE){
if (!is.null(keyorid)){
id_loc = suppressWarnings(!which(is.na(as.numeric(keyorid))))
keyorid[id_loc] = ukb_dic[str_detect(ukb_dic$Field,paste(keyorid[id_loc],collapse = "|")),"FieldID"]
}
cats = unlist(ukb_dic %>% filter(FieldID %in% ids) %>% distinct(Category))
loaded_cats = names(ukb_data_list)
patterns = paste0("^",ids,"-")
output = list()
if (loaded_cats[1] == "ALL"){
output = ukb_data_list[["ALL"]][str_detect(colnames(ukb_data_list[["ALL"]]),paste(patterns,collapse = "|"))]
}
else{
for (cat in cats){
if (cat %in% loaded_cats){
found = ukb_data_list[[cat]][str_detect(colnames(ukb_data_list[[cat]]),paste(patterns,collapse = "|"))]
if (ncol(found)>0){
output[[cat]] = cbind(data.frame(eid = ukb_data_list[[cat]][,1]),found)
}
}
else{
print(paste0("You need to load the category: ",cat))
}
}
}
return (output)
}
get_field_data(c("Sexually molested as a child","20179","20242","3160"))
keyorid = c("Sexually molested as a child","20179","20242","3160")
id_loc = suppressWarnings(!which(is.na(as.numeric(keyorid))))
id_loc
id_loc = suppressWarnings(which(!is.na(as.numeric(keyorid))))
id_loc
id_loc = suppressWarnings(which(is.na(as.numeric(keyorid))))
keyorid[id_loc] = ukb_dic[str_detect(ukb_dic$Field,paste(keyorid[id_loc],collapse = "|")),"FieldID"]
keyorid
cats = unlist(ukb_dic %>% filter(FieldID %in% ids) %>% distinct(Category))
cats
cats = unlist(ukb_dic %>% filter(FieldID %in% keyorid) %>% distinct(Category))
cat
cats = unlist(ukb_dic %>% filter(FieldID %in% keyorid) %>% distinct(Category))
cat
cats
loaded_cats = names(ukb_data_list)
loaded_cats
patterns = paste0("^",keyorid,"-")
patterns
for (cat in cats){
if (cat %in% loaded_cats){
found = ukb_data_list[[cat]][str_detect(colnames(ukb_data_list[[cat]]),paste(patterns,collapse = "|"))]
if (ncol(found)>0){
output[[cat]] = cbind(data.frame(eid = ukb_data_list[[cat]][,1]),found)
}
}
else{
print(paste0("You need to load the category: ",cat))
}
}
get_field_data = function(keyorid = NULL,match_name=FALSE){
if (!is.null(keyorid)){
id_loc = suppressWarnings(which(is.na(as.numeric(keyorid))))
keyorid[id_loc] = ukb_dic[str_detect(ukb_dic$Field,paste(keyorid[id_loc],collapse = "|")),"FieldID"]
}
cats = unlist(ukb_dic %>% filter(FieldID %in% keyorid) %>% distinct(Category))
loaded_cats = names(ukb_data_list)
patterns = paste0("^",keyorid,"-")
output = list()
if (loaded_cats[1] == "ALL"){
output = ukb_data_list[["ALL"]][str_detect(colnames(ukb_data_list[["ALL"]]),paste(patterns,collapse = "|"))]
}
else{
for (cat in cats){
if (cat %in% loaded_cats){
found = ukb_data_list[[cat]][str_detect(colnames(ukb_data_list[[cat]]),paste(patterns,collapse = "|"))]
if (ncol(found)>0){
output[[cat]] = cbind(data.frame(eid = ukb_data_list[[cat]][,1]),found)
}
}
else{
print(paste0("You need to load the category: ",cat))
}
}
}
return (output)
}
get_field_data(c("Sexually molested as a child","20179","20242","3160"))
output = get_field_data(c("Sexually molested as a child","20179","20242","3160"))
output
dim(output)
length(output)
names(output)
cats
loaded_cats
get_field_data = function(keyorid = NULL,match_name=FALSE){
if (!is.null(keyorid)){
id_loc = suppressWarnings(which(is.na(as.numeric(keyorid))))
keyorid[id_loc] = ukb_dic[str_detect(ukb_dic$Field,paste(keyorid[id_loc],collapse = "|")),"FieldID"]
}
cats = unlist(ukb_dic %>% filter(FieldID %in% keyorid) %>% distinct(Category))
loaded_cats = names(ukb_data_list)
patterns = paste0("^",keyorid,"-")
output = list()
if (loaded_cats[1] == "ALL"){
output = ukb_data_list[["ALL"]][str_detect(colnames(ukb_data_list[["ALL"]]),paste(patterns,collapse = "|"))]
}
else{
for (cat in cats){
if (cat %in% loaded_cats){
found = ukb_data_list[[cat]][str_detect(colnames(ukb_data_list[[cat]]),paste(patterns,collapse = "|"))]
if (ncol(found)>0){
output[[cat]] = cbind(data.frame(eid = ukb_data_list[[cat]][,1]),found)
}
}
else{
print(paste0("You need to load the category: ",cat))
}
}
}
return (output)
}
get_field_data(c("Sexually molested as a child","20179","20242","3160"))
for (o in output){
print(colnames(o))
}
sapply(colnames(o),function(x){strsplit(x,"-")}[[1]][1])
sapply(colnames(o),function(x){strsplit(x,"-")}[[1]][1])[2:]
sapply(colnames(o),function(x){strsplit(x,"-")}[[1]][1])[-1]
field = sapply(colnames(o),function(x){strsplit(x,"-")}[[1]][1])[-1]
ukb_dic[str_detect(ukb_dic$Field,paste(field,collapse = "|")),"FieldID"]
str_detect(ukb_dic$Field,paste(field,collapse = "|"))
paste(field,collapse = "|")
ukb_dic$Field
ukb_dic[str_detect(ukb_dic$FieldID,paste(field,collapse = "|")),"Field"]
ukb_dic[str_detect(ukb_dic$FieldID,paste(field,collapse = "|")),]
field = sapply(colnames(o),function(x){strsplit(x,"-")}[[1]][1])[-1]
postfix = sapply(colnames(o),function(x){strsplit(x,"-")}[[1]][2])[-1]
field
postfix
paste0(ukb_dic[str_detect(ukb_dic$FieldID,paste(field,collapse = "|")),"Field"],postfix)
paste0(ukb_dic[str_detect(ukb_dic$FieldID,paste(field,collapse = "|")),"Field"],"-",postfix)
get_field_data = function(keyorid = NULL,match_name=FALSE){
if (!is.null(keyorid)){
id_loc = suppressWarnings(which(is.na(as.numeric(keyorid))))
keyorid[id_loc] = ukb_dic[str_detect(ukb_dic$Field,paste(keyorid[id_loc],collapse = "|")),"FieldID"]
}
cats = unlist(ukb_dic %>% filter(FieldID %in% keyorid) %>% distinct(Category))
loaded_cats = names(ukb_data_list)
patterns = paste0("^",keyorid,"-")
output = list()
if (loaded_cats[1] == "ALL"){
output = ukb_data_list[["ALL"]][str_detect(colnames(ukb_data_list[["ALL"]]),paste(patterns,collapse = "|"))]
}
else{
for (cat in cats){
if (cat %in% loaded_cats){
found = ukb_data_list[[cat]][str_detect(colnames(ukb_data_list[[cat]]),paste(patterns,collapse = "|"))]
if (ncol(found)>0){
output[[cat]] = cbind(data.frame(eid = ukb_data_list[[cat]][,1]),found)
}
}
else{
print(paste0("You need to load the category: ",cat))
}
}
}
if (match_name){
for (o in output){
field = sapply(colnames(o),function(x){strsplit(x,"-")}[[1]][1])[-1]
postfix = sapply(colnames(o),function(x){strsplit(x,"-")}[[1]][2])[-1]
colnames(o)[-1] = paste0(ukb_dic[str_detect(ukb_dic$FieldID,paste(field,collapse = "|")),"Field"],"-",postfix)
}
}
return (output)
}
output = get_field_data(c("Sexually molested as a child","20179","20242","3160"), TRUE)
output
get_field_data = function(keyorid = NULL,match_name=FALSE){
if (!is.null(keyorid)){
id_loc = suppressWarnings(which(is.na(as.numeric(keyorid))))
keyorid[id_loc] = ukb_dic[str_detect(ukb_dic$Field,paste(keyorid[id_loc],collapse = "|")),"FieldID"]
}
cats = unlist(ukb_dic %>% filter(FieldID %in% keyorid) %>% distinct(Category))
loaded_cats = names(ukb_data_list)
patterns = paste0("^",keyorid,"-")
output = list()
if (loaded_cats[1] == "ALL"){
output = ukb_data_list[["ALL"]][str_detect(colnames(ukb_data_list[["ALL"]]),paste(patterns,collapse = "|"))]
}
else{
for (cat in cats){
if (cat %in% loaded_cats){
found = ukb_data_list[[cat]][str_detect(colnames(ukb_data_list[[cat]]),paste(patterns,collapse = "|"))]
if (ncol(found)>0){
output[[cat]] = cbind(data.frame(eid = ukb_data_list[[cat]][,1]),found)
}
}
else{
print(paste0("You need to load the category: ",cat))
}
}
}
if (match_name){
for (o in output){
field = sapply(colnames(o),function(x){strsplit(x,"-")}[[1]][1])[-1]
postfix = sapply(colnames(o),function(x){strsplit(x,"-")}[[1]][2])[-1]
colnames(o)[-1] = paste0(ukb_dic[str_detect(ukb_dic$FieldID,paste(field,collapse = "|")),"Field"],"-",postfix)
}
}
return (output)
}
output = get_field_data(c("Sexually molested as a child","20179","20242","3160"), TRUE)
head(output)
head(output[[1]])
o
field = sapply(colnames(o),function(x){strsplit(x,"-")}[[1]][1])[-1]
postfix = sapply(colnames(o),function(x){strsplit(x,"-")}[[1]][2])[-1]
colnames(o)[-1] = paste0(ukb_dic[str_detect(ukb_dic$FieldID,paste(field,collapse = "|")),"Field"],"-",postfix)
head(o)
output = get_field_data(c("Sexually molested as a child","20179","20242","3160"), match_name = TRUE)
output
for (n in names(output)){
field = sapply(colnames(output[[n]]),function(x){strsplit(x,"-")}[[1]][1])[-1]
postfix = sapply(colnames(output[[n]]),function(x){strsplit(x,"-")}[[1]][2])[-1]
colnames(output[[n]])[-1] = paste0(ukb_dic[str_detect(ukb_dic$FieldID,paste(field,collapse = "|")),"Field"],"-",postfix)
}
head(output[[1]])
get_field_data = function(keyorid = NULL,match_name=FALSE){
if (!is.null(keyorid)){
id_loc = suppressWarnings(which(is.na(as.numeric(keyorid))))
keyorid[id_loc] = ukb_dic[str_detect(ukb_dic$Field,paste(keyorid[id_loc],collapse = "|")),"FieldID"]
}
cats = unlist(ukb_dic %>% filter(FieldID %in% keyorid) %>% distinct(Category))
loaded_cats = names(ukb_data_list)
patterns = paste0("^",keyorid,"-")
output = list()
if (loaded_cats[1] == "ALL"){
output = ukb_data_list[["ALL"]][str_detect(colnames(ukb_data_list[["ALL"]]),paste(patterns,collapse = "|"))]
}
else{
for (cat in cats){
if (cat %in% loaded_cats){
found = ukb_data_list[[cat]][str_detect(colnames(ukb_data_list[[cat]]),paste(patterns,collapse = "|"))]
if (ncol(found)>0){
output[[cat]] = cbind(data.frame(eid = ukb_data_list[[cat]][,1]),found)
}
}
else{
print(paste0("You need to load the category: ",cat))
}
}
}
if (match_name){
for (n in names(output)){
field = sapply(colnames(output[[n]]),function(x){strsplit(x,"-")}[[1]][1])[-1]
postfix = sapply(colnames(output[[n]]),function(x){strsplit(x,"-")}[[1]][2])[-1]
colnames(output[[n]])[-1] = paste0(ukb_dic[str_detect(ukb_dic$FieldID,paste(field,collapse = "|")),"Field"],"-",postfix)
}
}
return (output)
}
output = get_field_data(c("Sexually molested as a child","20179","20242","3160"), match_name = TRUE)
output
keyorid
id_loc = suppressWarnings(which(!is.na(as.numeric(keyorid))))
id_loc
id = keyorid[id_loc]
id
keyorid[id_loc] = unlist(ukb_dic %>% filter(CategoryID %in% id) %>% select(Category))
keyorid = c("Dementia outcomes","Asthma outcomes","46")
id_loc = suppressWarnings(which(!is.na(as.numeric(keyorid))))
id = keyorid[id_loc]
keyorid[id_loc] = unlist(ukb_dic %>% filter(CategoryID %in% id) %>% select(Category))
keyorid
ukb_dic %>% filter(Category %in% keyorid)
field_ids = ukb_dic %>% filter(Category %in% keyorid) %>% select(Category,FieldID,Field)
field_ids
}
prepare_get_field_ids = function(keyorid = NULL){
ukb_dic = aws.s3::s3readRDS("s3://ukb.tbilab/genome/UKB_Field_Dictionary.rds")
if (is.null(keyorid)){
field_ids = ukb_dic %>% select(Category,FieldID,Field)
}
else{
id_loc = suppressWarnings(which(!is.na(as.numeric(keyorid))))
id = keyorid[id_loc]
keyorid[id_loc] = unlist(ukb_dic %>% filter(CategoryID %in% id) %>% select(Category))
field_ids = ukb_dic %>% filter(Category %in% keyorid) %>% select(Category,FieldID,Field)
}
return(field_ids)
}
prepare_get_field_ids(c("Dementia outcomes","Asthma outcomes","46"))
id_loc = suppressWarnings(which(!is.na(as.numeric(keyorid))))
id = keyorid[id_loc]
id
keyorid
id_loc
id_loc
prepare_get_category(c("Asthma","blood"))
keyorid = c("Dementia outcomes","Asthma outcomes","46")
id_loc = suppressWarnings(which(!is.na(as.numeric(keyorid))))
id = keyorid[id_loc]
id
ukb_dic %>% filter(CategoryID %in% id) %>% select(Category)
ukb_dic %>% filter(CategoryID %in% id)
prepare_get_field_ids = function(keyorid = NULL){
ukb_dic = aws.s3::s3readRDS("s3://ukb.tbilab/genome/UKB_Field_Dictionary.rds")
if (is.null(keyorid)){
field_ids = ukb_dic %>% select(Category,FieldID,Field)
}
else{
id_loc = suppressWarnings(which(!is.na(as.numeric(keyorid))))
id = keyorid[id_loc]
keyorid[id_loc] = unlist(ukb_dic %>% filter(CategoryID %in% id) %>% distinct(Category))
field_ids = ukb_dic %>% filter(Category %in% keyorid) %>% select(Category,FieldID,Field)
}
return(field_ids)
}
prepare_get_field_ids(c("Dementia outcomes","Asthma outcomes","46"))
